<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ü§ñ AI Translator ‚Äî Futuristic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{
      --bg-deep:#0c0b16;
      --glass:rgba(255,255,255,0.08);
      --panel:rgba(20,20,35,0.45);
      --border:rgba(255,255,255,0.18);
      --txt:#ecf1ff;
      --accent:#ffd166;
      --accent2:#7bdff2;
      --accent3:#c77dff;
    }
    html,body{height:100%;background:var(--bg-deep);color:var(--txt);overflow-x:hidden;}

    /* Animated halo gradient behind container */
    .halo{
      position:fixed; inset:-20% -10% auto -10%; height:60vh; z-index:0;
      background: radial-gradient(60% 60% at 30% 30%, rgba(123,223,242,0.18), transparent 60%),
                  radial-gradient(50% 50% at 80% 20%, rgba(199,125,255,0.16), transparent 70%),
                  radial-gradient(40% 40% at 60% 80%, rgba(255,209,102,0.14), transparent 70%);
      filter: blur(50px);
      animation: drift 18s ease-in-out infinite alternate;
    }
    @keyframes drift{ to{ transform: translateY(40px) translateX(20px) scale(1.03);} }

    /* Vanta canvas sits at the very back */
    #bg{ position:fixed; inset:0; z-index:0; }

    .wrap{ position:relative; z-index:2; padding: clamp(18px,2.4vw,28px); }
    .glass{
      background: var(--glass);
      backdrop-filter: blur(18px);
      border: 1px solid var(--border);
      border-radius: 26px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06), 0 10px 50px rgba(0,0,0,0.4);
      padding: clamp(18px,2.2vw,26px);
      position: relative;
      overflow: hidden;
    }
    /* animated edge highlight */
    .glass::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background: conic-gradient(from 0deg, rgba(123,223,242,0.2), rgba(199,125,255,0.2), rgba(255,209,102,0.2), rgba(123,223,242,0.2));
      mask: radial-gradient(farthest-side, transparent 92%, black 95%);
      animation: spin 12s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    .title{
      display:flex; gap:12px; align-items:center; font-weight:700; letter-spacing:.3px;
    }

    /* Robot avatar (SVG) */
    .bot{
      width:46px; height:46px; border-radius:12px;
      background: linear-gradient(135deg, #171628, #242145);
      border:1px solid var(--border);
      display:grid; place-items:center; position:relative; overflow:hidden;
      box-shadow: 0 8px 26px rgba(0,0,0,0.35);
    }
    .bot svg{ width:28px; height:28px; }
    .eye{ transform-origin:center; animation: blink 5s infinite; }
    @keyframes blink{ 0%,48%,52%,100%{ transform: scaleY(1);} 50%{ transform: scaleY(.1);} }

    .panel{
      background: var(--panel);
      border-radius: 18px;
      padding: 16px;
      border: 1px solid var(--border);
      height:100%;
    }
    .select-dark{
      background: rgb(0, 0, 0);
      color: #ffffff; /* Changed from var(--txt) to black */
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 8px 10px;
    }
    textarea{
      background: rgba(255,255,255,0.08);
      color:var(--txt);
      border: 1px solid var(--border);
      border-radius: 14px;
      resize: none;
      min-height: 190px;
    }
    .round{
      width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      border: 1px solid var(--border); background: rgba(255,255,255,0.10); color:var(--txt);
    }
    .round.active{ box-shadow: 0 0 0 6px rgba(255,77,77,0.14), 0 0 20px rgba(255,77,77,0.35); }
    .swap{
      width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      border: 1px solid var(--border); background: rgba(255,255,255,0.10);
    }

    .btn-ai{
      border-radius: 100px; border:0; padding: 12px 26px; font-weight:700; letter-spacing:.2px;
      color:#101018;
      background: linear-gradient(135deg, var(--accent), #ff9f1c);
      box-shadow: 0 10px 30px rgba(255,209,102,0.35);
      transition: transform .08s ease;
    }
    .btn-ai:active{ transform: translateY(1px) scale(.99); }

    /* Waveform (CSS bars) */
    .wave{
      height:26px; display:flex; gap:4px; align-items:flex-end; visibility:hidden;
    }
    .wave span{
      display:block; width:3px; background: linear-gradient(#7bdff2, #c77dff);
      border-radius:2px; animation: wave 1s ease-in-out infinite; opacity:.9;
    }
    .wave span:nth-child(2){animation-delay:.1s}
    .wave span:nth-child(3){animation-delay:.2s}
    .wave span:nth-child(4){animation-delay:.3s}
    .wave span:nth-child(5){animation-delay:.4s}
    @keyframes wave{ 0%,100%{height:4px} 50%{height:26px}}

    .status{ font-size:14px; opacity:.85 }
    .status b{ font-weight:700 }
    .typing::after{ content:'‚ãØ'; margin-left:6px; animation: blink 1s infinite steps(1,end); }
  </style>
</head>
<body>
  <!-- animated networks (behind everything) -->
  <div id="bg"></div>
  <div class="halo"></div>

  <div class="wrap container-xxl">
    <div class="glass">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="title">
          <div class="bot" id="bot">
            <!-- Simple animated SVG robot -->
            <svg viewBox="0 0 64 64" fill="none">
              <rect x="10" y="16" width="44" height="32" rx="8" fill="#23233f"/>
              <circle cx="25" cy="32" r="5" fill="#7bdff2" class="eye"/>
              <circle cx="39" cy="32" r="5" fill="#7bdff2" class="eye"/>
              <rect x="22" y="42" width="20" height="3" rx="1.5" fill="#ffd166"/>
              <rect x="30" y="8" width="4" height="8" rx="2" fill="#c77dff"/>
            </svg>
          </div>
          <h3 class="m-0">AI Translator</h3>
        </div>
        <div class="status" id="status">Ready <span>‚úÖ</span></div>
      </div>

      <div class="row g-3">
        <!-- Source -->
        <div class="col-lg-5">
          <div class="panel h-100">
            <div class="d-flex gap-2 justify-content-between">
              <select id="srcLang" class="form-select select-dark">
                <option value="auto">Auto-detect</option>
                {% for code, name in languages.items() %}
                  <option value="{{ code }}">{{ name|capitalize }}</option>
                {% endfor %}
              </select>
              <button class="round" id="micBtn" title="Speak"><i class="fa-solid fa-microphone"></i></button>
            </div>
            <textarea id="srcText" class="form-control mt-3" placeholder="Type or speak anything‚Ä¶"></textarea>
            <div class="mt-2 d-flex align-items-center justify-content-between">
              <div class="wave" id="wave">
                <span></span><span></span><span></span><span></span><span></span>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="autoSwitch" checked>
                <label class="form-check-label" for="autoSwitch">Auto-translate</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Swap -->
        <div class="col-lg-2 d-flex align-items-center justify-content-center">
          <button class="swap" id="swapBtn" title="Swap"><i class="fa-solid fa-right-left"></i></button>
        </div>

        <!-- Target -->
        <div class="col-lg-5">
          <div class="panel h-100">
            <div class="d-flex gap-2 justify-content-between">
              <select id="tgtLang" class="form-select select-dark">
                {% for code, name in languages.items() %}
                  <option value="{{ code }}" {% if code == "en" %}selected{% endif %}>{{ name|capitalize }}</option>
                {% endfor %}
              </select>
              <button class="round" id="speakBtn" title="Listen"><i class="fa-solid fa-volume-high"></i></button>
            </div>
            <textarea id="tgtText" class="form-control mt-3" placeholder="Translation appears here‚Ä¶" readonly></textarea>
            <div class="mt-2 text-end small opacity-75" id="detected"></div>
          </div>
        </div>
      </div>

      <div class="text-center mt-4">
        <button class="btn-ai" id="translateBtn"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Translate</button>
      </div>
    </div>
  </div>

  <!-- BG animation libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@0.5.24/dist/vanta.net.min.js"></script>

  <script>
    // Background network
    VANTA.NET({
      el: "#bg",
      color: 0x7bdff2, backgroundColor: 0x0c0b16,
      maxDistance: 22.0, spacing: 18.0, points: 12.0,
      gyroControls:false, mouseControls:true, touchControls:true
    });

    // Elements
    const srcText = document.getElementById('srcText');
    const tgtText = document.getElementById('tgtText');
    const srcLang = document.getElementById('srcLang');
    const tgtLang = document.getElementById('tgtLang');
    const micBtn  = document.getElementById('micBtn');
    const speakBtn= document.getElementById('speakBtn');
    const swapBtn = document.getElementById('swapBtn');
    const translateBtn = document.getElementById('translateBtn');
    const statusEl = document.getElementById('status');
    const wave = document.getElementById('wave');
    const autoSwitch = document.getElementById('autoSwitch');
    const detectedEl = document.getElementById('detected');
    const bot = document.getElementById('bot');

    // Helpers
    const debounce = (fn, delay=600)=>{ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay); } };

    async function translateNow(fromTyping=false){
      const text = srcText.value.trim();
      if(!text){ tgtText.value = ""; detectedEl.textContent=""; return; }
      status("Translating‚Ä¶ ‚öôÔ∏è");
      const form = new FormData();
      form.append("text", text);
      form.append("src_lang", srcLang.value || "auto");
      form.append("tgt_lang", tgtLang.value || "en");
      const res = await fetch('/translate', {method:'POST', body:form});
      const data = await res.json();
      if(data.error){ status("Error ‚ö†Ô∏è"); return; }
      tgtText.value = data.translated || "";
      detectedEl.textContent = data.detected_lang ? `Detected: ${data.detected_lang}` : "";
      if (srcLang.value==="auto" && data.detected_code){ srcLang.value = data.detected_code; }
      status(fromTyping ? "Auto translated ‚úÖ" : "Translated ‚úÖ");
    }
    const debouncedTranslate = debounce(()=>translateNow(true), 650);

    function status(text){ statusEl.innerHTML = text; }

    // Manual translate
    translateBtn.addEventListener('click', ()=>translateNow(false));

    // Auto translate on typing
    srcText.addEventListener('input', ()=>{ if(autoSwitch.checked){ debouncedTranslate(); } });

    // Swap
    swapBtn.addEventListener('click', ()=>{
      const a = srcLang.value, b = tgtLang.value; srcLang.value=b; tgtLang.value=a;
      const ta = srcText.value, tb = tgtText.value; srcText.value=tb; tgtText.value=ta;
      if(autoSwitch.checked){ debouncedTranslate(); }
    });

    // TTS of target
    speakBtn.addEventListener('click', async ()=>{
      const text = tgtText.value.trim(); if(!text) return;
      const form = new FormData(); form.append("text", text); form.append("lang", tgtLang.value || "en");
      const res = await fetch('/tts',{method:'POST',body:form}); const data=await res.json();
      if(data.error){ status("TTS error ‚ö†Ô∏è"); return; }
      new Audio(data.audio_url).play();
    });

    // ====== Voice input via Web Speech API (best for Hinglish/mixed) ======
    let recognition = null;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = true;
      recognition.lang = 'en-IN'; // Hinglish-friendly; translation uses auto-detect anyway
    }

    function listen(){
      if(!recognition){ alert("Speech recognition not supported. Use Chrome."); return; }
      micBtn.classList.add('active'); wave.style.visibility='visible'; status("Listening‚Ä¶ üéôÔ∏è"); srcText.classList.add('typing');
      let finalTranscript = "";
      recognition.onresult = (e)=>{
        let interim=""; for(let i=e.resultIndex;i<e.results.length;i++){
          const t=e.results[i][0].transcript;
          if(e.results[i].isFinal) finalTranscript += t + " "; else interim += t;
        }
        srcText.value = (finalTranscript + " " + interim).trim();
        if(autoSwitch.checked){ debouncedTranslate(); }
      };
      recognition.onerror = (e)=>{ status("Mic error ‚ö†Ô∏è"); stopListen(); };
      recognition.onend = ()=>{ stopListen(); status("Processing speech‚Ä¶ ‚öôÔ∏è"); translateNow(true); };
      recognition.start();
      bot.style.filter = "drop-shadow(0 0 10px rgba(123,223,242,.8))";
    }
    function stopListen(){
      micBtn.classList.remove('active'); wave.style.visibility='hidden'; srcText.classList.remove('typing');
      bot.style.filter = "";
    }
    micBtn.addEventListener('click', listen);
  </script>
</body>
</html>
